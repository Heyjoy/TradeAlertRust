# 交易预警系统开发计划

## 开发原则
- 每个阶段都能产生可用的功能
- 优先实现核心价值功能
- 保持代码简洁，避免过度工程化
- 每个阶段完成后进行测试验证

---

## 第一阶段：核心后端API (预计1天)

### 目标
基于当前简化的数据库结构，实现基本的预警CRUD功能

### 当前状态分析
- ✅ 应用能正常编译和运行 (127.0.0.1:3000)
- ✅ 数据库结构简化 (仅alerts表: id, symbol, condition, price, status, created_at, updated_at, triggered_at)
- ✅ 基础框架搭建完成
- ❌ 需要更新模型定义匹配新数据库结构
- ❌ 需要完善API实现

### 任务清单
- [ ] 1.1 更新模型定义
  - 根据新的数据库字段更新 Alert 模型
  - 更新 CreateAlertRequest 和 AlertResponse
  - 删除不再需要的 AlertHistory 模型

- [ ] 1.2 完善预警管理API
  - 修复 `POST /api/alerts` - 使用实际数据库保存
  - `GET /api/alerts` - 获取预警列表
  - `GET /api/alerts/{id}` - 获取单个预警
  - `DELETE /api/alerts/{id}` - 删除预警

- [ ] 1.3 测试API功能
  - 使用 curl/Postman 测试所有接口
  - 验证数据持久化

### 验收标准
- 所有API能正常响应
- 能通过Postman/curl创建和管理预警
- 数据能正确保存到数据库

---

## 第二阶段：价格监控与触发 (预计1天)

### 目标
实现自动价格监控和预警触发机制

### 任务清单
- [ ] 2.1 完善价格获取功能
  - 确保 PriceFetcher 能正常获取Yahoo Finance数据
  - 添加错误处理和重试机制
  - 测试几个常见股票(AAPL, TSLA, MSFT)

- [ ] 2.2 优化定时任务
  - 确保定时任务能定期获取价格并检查预警
  - 添加日志记录
  - 预警触发后状态更新为 'triggered'

- [ ] 2.3 基础通知功能（控制台输出）
  - 预警触发时在控制台输出详细信息
  - 为后续邮件通知做准备

### 验收标准
- 定时任务稳定运行
- 价格达到条件时能正确触发预警
- 控制台能看到触发信息和价格更新

---

## 第三阶段：简单Web界面 (预计1-2天)

### 目标
提供基本的Web界面，支持预警的创建和查看

### 任务清单
- [ ] 3.1 预警列表页面
  - 首页显示所有预警
  - 简单的表格布局
  - 显示: 股票代码、条件、目标价格、状态、创建时间

- [ ] 3.2 预警创建表单
  - 简单的HTML表单 (股票代码、条件、价格)
  - 表单提交到 POST /api/alerts
  - 基础前端验证

- [ ] 3.3 预警管理功能
  - 列表页面添加删除按钮
  - 简单的状态显示(active/triggered/cancelled)

### 验收标准
- 能通过网页查看所有预警
- 能通过网页创建新预警
- 能通过网页删除预警

---

## 第四阶段：邮件通知 (预计1天)

### 目标
添加邮件通知功能，完善通知体系

### 任务清单
- [ ] 4.1 添加邮箱字段
  - 在alerts表中添加email字段
  - 更新模型和表单

- [ ] 4.2 邮件发送功能
  - 添加SMTP配置(建议QQ邮箱)
  - 实现邮件发送模块
  - 简单的邮件模板

- [ ] 4.3 集成到预警触发
  - 预警触发时发送邮件通知
  - 邮件内容包含股票代码、触发价格、时间等

### 验收标准
- 预警触发时能收到邮件通知
- 邮件内容清晰易懂

---

## 第五阶段：功能完善 (预计1天)

### 目标
系统稳定性和用户体验提升

### 任务清单
- [ ] 5.1 界面美化
  - 使用简单的CSS美化界面
  - 添加响应式设计

- [ ] 5.2 实时价格显示
  - 在预警列表中显示当前价格
  - 定期刷新页面或使用简单的JavaScript

- [ ] 5.3 错误处理
  - 完善API错误处理
  - 用户友好的错误提示

### 验收标准
- 界面美观易用
- 实时显示当前股票价格
- 错误处理完善

---

## 总体时间估算
- **总计：5-6天** (比原计划大幅缩短)
- 每个阶段1天，快速迭代
- 每个阶段完成后进行测试验证

## 当前状态
- ✅ 项目基础架构搭建
- ✅ 应用能正常运行
- ✅ 数据库结构简化完成
- ❌ 开始第一阶段开发

## 下一步行动
1. ✅ ~~修复编译错误~~ (已完成)
2. 🚀 **立即开始第一阶段**: 更新模型定义和完善API
3. 每个阶段结束后进行测试

## 简化说明
基于当前简化的数据库结构，我们去掉了：
- 复杂的历史记录表 (alert_history, price_history)
- 复杂的数据库迁移问题
- 过度的工程化设计

现在可以专注于核心功能的快速实现！ 