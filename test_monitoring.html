<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¢„è­¦æ˜¾ç¤ºä¿®å¤æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 2rem;
        }
        .test-section {
            margin-bottom: 2rem;
            padding: 1rem;
            border: 1px solid #e9ecef;
            border-radius: 8px;
        }
        .test-section h3 {
            color: #2c3e50;
            margin-top: 0;
        }
        .result {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 6px;
            margin-top: 1rem;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            margin-right: 0.5rem;
        }
        .btn:hover {
            background: #2980b9;
        }
        .loading {
            color: #666;
            font-style: italic;
        }
        .success {
            color: #27ae60;
            font-weight: bold;
        }
        .error {
            color: #e74c3c;
            font-weight: bold;
        }
        .critical {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 6px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”§ é¢„è­¦æ˜¾ç¤ºä¿®å¤æµ‹è¯•</h1>
            <p>æµ‹è¯•é¢„è­¦æ˜¾ç¤ºé—®é¢˜çš„ä¿®å¤æ•ˆæœ</p>
        </div>

        <div class="critical">
            <h4>ğŸš¨ å·²çŸ¥é—®é¢˜ä¿®å¤çŠ¶æ€</h4>
            <ul>
                <li>âœ… SQLè¯­æ³•é”™è¯¯ï¼šå·²ä¿®å¤get_market_alertså‡½æ•°ä¸­çš„é”™è¯¯SQL</li>
                <li>âœ… ä¸»é¡µé¢„è­¦æ˜¾ç¤ºï¼šå·²åœ¨dashboardä¸­å¢åŠ é¢„è­¦åˆ—è¡¨æ˜¾ç¤º</li>
                <li>âœ… é¢„è­¦çŠ¶æ€æ ·å¼ï¼šå·²å¢åŠ çŠ¶æ€å¾½ç« å’Œå¡ç‰‡æ ·å¼</li>
            </ul>
        </div>

        <div class="test-section">
            <h3>ğŸ  ä¸»é¡µé¢„è­¦æ˜¾ç¤ºæµ‹è¯•</h3>
            <p>æµ‹è¯•ä¸»é¡µæ˜¯å¦èƒ½æ­£ç¡®æ˜¾ç¤ºæ·»åŠ çš„é¢„è­¦ï¼ˆåŒ…æ‹¬å·²è§¦å‘çš„AAPLé¢„è­¦ï¼‰</p>
            <button class="btn" onclick="testHomepageAlerts()">æµ‹è¯•ä¸»é¡µé¢„è­¦</button>
            <div id="homepage-result" class="result">ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•...</div>
        </div>

        <div class="test-section">
            <h3>ğŸ“‹ é¢„è­¦åˆ—è¡¨é¡µé¢æµ‹è¯•</h3>
            <p>æµ‹è¯• /alerts é¡µé¢æ˜¯å¦èƒ½æ­£ç¡®æ˜¾ç¤ºé¢„è­¦åˆ—è¡¨</p>
            <button class="btn" onclick="testAlertsPage()">æµ‹è¯•é¢„è­¦åˆ—è¡¨</button>
            <div id="alerts-result" class="result">ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•...</div>
        </div>

        <div class="test-section">
            <h3>ğŸ¯ å·²è§¦å‘é¢„è­¦æ£€æµ‹</h3>
            <p>æ£€æµ‹æ—¥å¿—ä¸­æ˜¾ç¤ºçš„AAPLé¢„è­¦è§¦å‘æ˜¯å¦åœ¨UIä¸­å¯è§</p>
            <button class="btn" onclick="testTriggeredAlerts()">æ£€æµ‹è§¦å‘é¢„è­¦</button>
            <div id="triggered-result" class="result">ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•...</div>
        </div>

        <div class="test-section">
            <h3>ğŸ“Š å¸‚åœºåˆ†ç±»æµ‹è¯•</h3>
            <p>æµ‹è¯•ä¿®å¤åçš„å¸‚åœºåˆ†ç±»ç»Ÿè®¡åŠŸèƒ½</p>
            <button class="btn" onclick="testMarketCategories()">æµ‹è¯•å¸‚åœºåˆ†ç±»</button>
            <div id="market-categories-result" class="result">ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•...</div>
        </div>

        <div class="test-section">
            <h3>ğŸ”— ç›´æ¥è®¿é—®æµ‹è¯•</h3>
            <p>ç›´æ¥æ‰“å¼€å„ä¸ªé¡µé¢æŸ¥çœ‹é¢„è­¦æ˜¾ç¤º</p>
            <a href="http://localhost:3000/" target="_blank" class="btn">ä¸»é¡µ (åº”è¯¥æ˜¾ç¤ºé¢„è­¦)</a>
            <a href="http://localhost:3000/alerts" target="_blank" class="btn">é¢„è­¦åˆ—è¡¨</a>
            <a href="http://localhost:3000/alerts/new" target="_blank" class="btn">æ·»åŠ é¢„è­¦</a>
        </div>

        <div class="test-section">
            <h3>ğŸ”„ å®æ—¶æµ‹è¯•</h3>
            <p>æ¯5ç§’è‡ªåŠ¨æ£€æµ‹é¢„è­¦çŠ¶æ€å˜åŒ–</p>
            <button class="btn" onclick="startLiveMonitoring()" id="live-btn">å¼€å§‹å®æ—¶ç›‘æ§</button>
            <div id="live-result" class="result">ç‚¹å‡»æŒ‰é’®å¼€å§‹å®æ—¶ç›‘æ§...</div>
        </div>
    </div>

    <script>
        let liveMonitoring = false;
        let liveInterval;

        async function testHomepageAlerts() {
            const result = document.getElementById('homepage-result');
            result.textContent = 'æ­£åœ¨æµ‹è¯•ä¸»é¡µé¢„è­¦æ˜¾ç¤º...';
            result.className = 'result loading';

            try {
                const response = await fetch('http://localhost:3000/');
                const html = await response.text();
                
                // æ£€æŸ¥æ˜¯å¦åŒ…å«é¢„è­¦ç›¸å…³å†…å®¹
                if (html.includes('æ´»è·ƒé¢„è­¦') && html.includes('AAPL')) {
                    result.textContent = 'âœ… æˆåŠŸï¼ä¸»é¡µæ˜¾ç¤ºäº†é¢„è­¦ä¿¡æ¯\n\n' + 
                                        'æ£€æµ‹åˆ°çš„å†…å®¹ï¼š\n' +
                                        '- æ´»è·ƒé¢„è­¦åŒºåŸŸ\n' +
                                        '- AAPLé¢„è­¦æ˜¾ç¤º\n' +
                                        '- é¢„è­¦çŠ¶æ€æ ‡è¯†';
                    result.className = 'result success';
                } else if (html.includes('æ´»è·ƒé¢„è­¦')) {
                    result.textContent = 'âš ï¸ éƒ¨åˆ†æˆåŠŸï¼šå‘ç°æ´»è·ƒé¢„è­¦åŒºåŸŸï¼Œä½†å¯èƒ½æ²¡æœ‰AAPLé¢„è­¦\n\n' +
                                        'è¯·æ£€æŸ¥ï¼š\n' +
                                        '- AAPLé¢„è­¦æ˜¯å¦æ­£ç¡®æ·»åŠ \n' +
                                        '- é¢„è­¦çŠ¶æ€æ˜¯å¦ä¸ºactiveæˆ–triggered';
                    result.className = 'result error';
                } else {
                    result.textContent = 'âŒ ä¸»é¡µä»æœªæ˜¾ç¤ºé¢„è­¦ä¿¡æ¯\n\n' +
                                        'å¯èƒ½åŸå› ï¼š\n' +
                                        '- æ•°æ®åº“æŸ¥è¯¢é—®é¢˜\n' +
                                        '- æ¨¡æ¿æ¸²æŸ“é—®é¢˜\n' +
                                        '- é¢„è­¦æ•°æ®ä¸ºç©º';
                    result.className = 'result error';
                }
            } catch (error) {
                result.textContent = 'âŒ æµ‹è¯•å¤±è´¥: ' + error.message + '\n\nè¯·ç¡®ä¿æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ';
                result.className = 'result error';
            }
        }

        async function testAlertsPage() {
            const result = document.getElementById('alerts-result');
            result.textContent = 'æ­£åœ¨æµ‹è¯•é¢„è­¦åˆ—è¡¨é¡µé¢...';
            result.className = 'result loading';

            try {
                const response = await fetch('http://localhost:3000/alerts');
                const html = await response.text();
                
                if (html.includes('AAPL') || html.includes('GOOGL') || html.includes('000001.SZ')) {
                    result.textContent = 'âœ… æˆåŠŸï¼é¢„è­¦åˆ—è¡¨é¡µé¢æ˜¾ç¤ºäº†é¢„è­¦æ•°æ®\n\n' + 
                                        'å»ºè®®ï¼šç›´æ¥æ‰“å¼€é¡µé¢æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯';
                    result.className = 'result success';
                } else if (html.includes('æš‚æ— é¢„è­¦')) {
                    result.textContent = 'âš ï¸ é¢„è­¦åˆ—è¡¨é¡µé¢æ˜¾ç¤º"æš‚æ— é¢„è­¦"\n\n' +
                                        'è¿™æ„å‘³ç€ï¼š\n' +
                                        '- æ•°æ®åº“ä¸­æ²¡æœ‰é¢„è­¦æ•°æ®\n' +
                                        '- æˆ–è€…æŸ¥è¯¢æ¡ä»¶æœ‰é—®é¢˜';
                    result.className = 'result error';
                } else {
                    result.textContent = 'âŒ æ— æ³•ç¡®å®šé¢„è­¦åˆ—è¡¨çŠ¶æ€';
                    result.className = 'result error';
                }
            } catch (error) {
                result.textContent = 'âŒ æµ‹è¯•å¤±è´¥: ' + error.message;
                result.className = 'result error';
            }
        }

        async function testTriggeredAlerts() {
            const result = document.getElementById('triggered-result');
            result.textContent = 'æ­£åœ¨æ£€æµ‹å·²è§¦å‘çš„é¢„è­¦...';
            result.className = 'result loading';

            try {
                const response = await fetch('http://localhost:3000/');
                const html = await response.text();
                
                if (html.includes('å·²è§¦å‘') && html.includes('AAPL')) {
                    result.textContent = 'âœ… æˆåŠŸï¼æ£€æµ‹åˆ°AAPLé¢„è­¦å·²è§¦å‘\n\n' + 
                                        'çŠ¶æ€ï¼šé¢„è­¦è§¦å‘åŠŸèƒ½æ­£å¸¸å·¥ä½œ\n' +
                                        'å»ºè®®ï¼šæ£€æŸ¥é‚®ä»¶é€šçŸ¥é…ç½®';
                    result.className = 'result success';
                } else {
                    result.textContent = 'âš ï¸ æœªåœ¨UIä¸­å‘ç°å·²è§¦å‘çš„AAPLé¢„è­¦\n\n' +
                                        'å¯èƒ½åŸå› ï¼š\n' +
                                        '- é¢„è­¦çŠ¶æ€æœªæ­£ç¡®æ›´æ–°åˆ°æ•°æ®åº“\n' +
                                        '- æ¨¡æ¿ä¸­è§¦å‘çŠ¶æ€æ˜¾ç¤ºæœ‰é—®é¢˜\n' +
                                        '- æŸ¥è¯¢æ¡ä»¶è¿‡æ»¤äº†è§¦å‘çŠ¶æ€';
                    result.className = 'result error';
                }
            } catch (error) {
                result.textContent = 'âŒ æµ‹è¯•å¤±è´¥: ' + error.message;
                result.className = 'result error';
            }
        }

        async function testMarketCategories() {
            const result = document.getElementById('market-categories-result');
            result.textContent = 'æ­£åœ¨æµ‹è¯•å¸‚åœºåˆ†ç±»åŠŸèƒ½...';
            result.className = 'result loading';

            try {
                const response = await fetch('http://localhost:3000/');
                const html = await response.text();
                
                if (html.includes('ç¾è‚¡') && html.includes('Aè‚¡') && html.includes('æ´»è·ƒ')) {
                    result.textContent = 'âœ… æˆåŠŸï¼å¸‚åœºåˆ†ç±»åŠŸèƒ½æ­£å¸¸\n\n' + 
                                        'æ£€æµ‹åˆ°ï¼š\n' +
                                        '- ç¾è‚¡å¸‚åœºç»Ÿè®¡\n' +
                                        '- Aè‚¡å¸‚åœºç»Ÿè®¡\n' +
                                        '- æ´»è·ƒé¢„è­¦è®¡æ•°\n' +
                                        '- æ— SQLé”™è¯¯';
                    result.className = 'result success';
                } else {
                    result.textContent = 'âŒ å¸‚åœºåˆ†ç±»åŠŸèƒ½å¯èƒ½ä»æœ‰é—®é¢˜';
                    result.className = 'result error';
                }
            } catch (error) {
                result.textContent = 'âŒ æµ‹è¯•å¤±è´¥: ' + error.message;
                result.className = 'result error';
            }
        }

        function startLiveMonitoring() {
            const btn = document.getElementById('live-btn');
            const result = document.getElementById('live-result');
            
            if (!liveMonitoring) {
                liveMonitoring = true;
                btn.textContent = 'åœæ­¢ç›‘æ§';
                result.textContent = 'å¼€å§‹å®æ—¶ç›‘æ§é¢„è­¦çŠ¶æ€...\n';
                result.className = 'result loading';
                
                liveInterval = setInterval(async () => {
                    try {
                        const response = await fetch('http://localhost:3000/');
                        const html = await response.text();
                        const timestamp = new Date().toLocaleTimeString();
                        
                        const alertCount = (html.match(/æ´»è·ƒé¢„è­¦/g) || []).length;
                        const hasAPPL = html.includes('AAPL');
                        
                        result.textContent += `[${timestamp}] æ´»è·ƒé¢„è­¦: ${alertCount}, AAPL: ${hasAPPL ? 'âœ“' : 'âœ—'}\n`;
                    } catch (error) {
                        result.textContent += `[${new Date().toLocaleTimeString()}] é”™è¯¯: ${error.message}\n`;
                    }
                }, 5000);
            } else {
                liveMonitoring = false;
                btn.textContent = 'å¼€å§‹å®æ—¶ç›‘æ§';
                clearInterval(liveInterval);
                result.textContent += '\nç›‘æ§å·²åœæ­¢ã€‚';
                result.className = 'result';
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•ä¸»é¡µ
        window.onload = function() {
            setTimeout(testHomepageAlerts, 1000);
        };
    </script>
</body>
</html> 